---
title: "05_JCVI-MCScanX"
author: "zagor"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: yes
    self_contained: yes
    fig_width: 9
    fig_height: 8
    toc: true
    toc_float:
      toc_collapsed: false
    toc_depth: 5
    number_sections: yes
    theme: flatly
    highlight: tango
  pdf_document:
    toc: yes
    toc_depth: '2'
  word_document:
    toc: yes
    toc_depth: '2'
editor_options:
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = c('png', 'pdf'),  # this embeds pdf and crates scrolable blocks if pdf is first
                      fig.path = "../reports/JCVI-MCScanX/", # save each figure here
                      # dev = c('png'), 
                      fig.align = 'center', 
                      dpi = 300,
                      fig.height = 8, 
                      fig.width = 9 ,
                      warning = FALSE, message = FALSE
                      )
```



```{r,  echo=TRUE, warning=FALSE, message=FALSE}

rm(list = ls(all = TRUE))
gc()


library(magrittr)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))




```

# plant selection

```{r}

fp = file.path('..', 'input', 'JCVI', 'IDs')
fl = list.files(fp)

myList = NULL

for (i in fl) {
  # print(i)
  lines = data.table::fread(file.path(fp, i), header = FALSE)
  ids = lines[, 4]
  colnames(ids) = 'ID'
  ids$plant = sub('\\..*', '', i)
  myList = rbind(myList, ids)

}

athList = myList[myList$plant == 'ath', ]


```

# input

```{r}

fp = file.path('..', 'input', 'JCVI')
files_all = list.files(path = fp, full.names = TRUE)
fl = files_all[!file.info(files_all)$isdir]
fl = fl[grep('anchors', fl)]

df = NULL

for (i in fl) {

  lines = readLines(i)
  lines_clean = lines[!grepl("^#", lines)]
  text_data = paste(lines_clean, collapse = "\n")
  dt = data.table::fread(text = text_data, sep = "\t", header = FALSE,
              col.names = c("from_id", "to_id", "JCVI_value"))
  df = rbind(df, dt)

}


colnames(athList) = c('from_id', 'from_plant')
df = merge(df, athList, by = c('from_id'), all = TRUE)


```

# output

```{r}


colnames(myList) = c('to_id', 'to_plant')
df = merge(df, myList, by = c('to_id'), all.x = TRUE)
columns = c("from_id", "from_plant", "to_id", "to_plant", "JCVI_value")
df = df[, ..columns]

df$source = 'MCScanX'


df = df[!duplicated(df), ]



file_path = '../intermediate/JCVI_MCScanX_plants.txt'
data.table::fwrite(df, file_path, sep = '\t')
root_dir = dirname(file_path)
file_name = basename(file_path)
zip::zip(zipfile = paste0(file_path, ".zip"), 
    files = file_name, 
    root = root_dir)
file.remove(file_path)


```


# sessionInfo

```{r,  echo=TRUE, warning=FALSE, message=FALSE}

sessionInfo()

```


